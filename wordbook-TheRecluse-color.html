<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>The HTML5 Herald</title>
  <meta name="description" content="The HTML5 Herald">
  <meta name="author" content="SitePoint">
  <style>

    article {
      -webkit-user-select: none; 
      -ms-user-select: none;
      user-select: none;
      font-size: 5vw;
      text-align: justify;
      line-height: 200%;
      text-indent: 0.5em;
    }

    #words-container {
      margin-top: 10vw;
    }

    #word-templete {
      display: none;
    }

    div.word-unit {
      margin: 10px 0px;
      padding: 5px 10px;
      border-radius: 5px;
      box-shadow: 0px 0px 5px grey;
    }
    
    div.word-unit .word-wrapper {
      display: flex;
      flex-direction: row;
      align-items: stretch;
    }

    div.word {
      flex:1;
      vertical-align: middle;
    }
    
    div.word-unit .meaning{
      margin-left: 10vw;
      font-size:small;
      line-height: 120%;
      vertical-align: middle;
    }
    
    div.word-unit .sents-container {
      background-color: #eeeeee;
      margin: 5px 0px;
      padding: 0px 5px;
      font-size: 3vw;
    }
    
    div.word-unit .offset {
      float: right;
    }

    div.sent-unit p {
      margin: 0px;
      line-height: 150%;
    }
    
    article.fun-reader {
      z-index:1;
      display:none;
    }

    #title {
      display: block;
      margin: 20vh 5vw;
      align-self: center;
      text-align: center;
      font-size: 8vw;
    }

    #instruct {
      position: relative;
      /* bottom:0; */
      margin-right: 20vw;
      border: 1px solid white;
      border-radius: 2vw;
      box-shadow: 0px 0px 5px grey;
      background-color: white;
      /* background-color: red; */
      z-index:2 !important;
    }
    
    #arrow {
      /* position: relative; */
      margin-left: 5vw;
      margin-top: -7vw;
      width: 9vw;
      height: 9vw;
      transform: rotate(45deg);
      background-color: white;
      box-shadow: 0px 0px 5px grey;
      z-index:1 !important;

    }

    /* The Modal (background) */
    .modal {
      display: none; /* Hidden by default */
      position: fixed; /* Stay in place */
      z-index: 10; /* Sit on top */
      padding-top: 100px; /* Location of the box */
      left: 0;
      top: 0;
      width: 100%; /* Full width */
      height: 100%; /* Full height */
      overflow: auto; /* Enable scroll if needed */
      background-color: rgb(0,0,0); /* Fallback color */
      background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
    }

    /* Modal Content */
    .modal-content {
      position: absolute;
      background-color: #fefefe;
      margin: auto;
      padding: 20px;
      border: 1px solid #888;
      width: 60%;
      border-radius: 2vw;
      box-shadow: 0px 0px 5px grey;
    }
    
    .modal-content > .dict-word{
      font-size: 1.5em;
      font-weight: bold;
      border-bottom: 1px solid black;
    }
    
    .modal-content > .dict-meaning{
      font-size: 1em;
      line-height: 150%;
      text-align:justify;
    }

    article span.sent[data-slash]::after{
      content:"/";
      font-weight:bolder;
      font-size:1.5em;
      line-height:5vw;
      color:grey;
    }
    
    /********** setting ********************/
    
    #setting-wrapper {
      display:flex;
      position:fixed;
      flex-direction: column-reverse;
      align-items:flex-end;
      right: 5vw;
      bottom: 5vw;
    }
    
    /* #setting-wrapper > div {
      margin: 1vw 0;
    } */

    #menu-btn {
      display: flex;
      flex-direction: column;
      justify-content: center;
      width: 10vw;
      height: 10vw;
      border-radius: 5vw;
      background-color: rgba(0,0,0,0.4);
    }
    
    #menu-btn > div {
      align-self:center;
      width: 4vw;
      height: 0.6vw;
      background-color: white;
      margin: 0.6vw 0;
    }

    
    #menu-btn[data-on]{
      background-color: red;
    }

    #setting-elems{
      display:none;
    }
    
    #menu-btn[data-on] ~ #setting-elems{
      display:block;      
    }

    .setting-elem{
      display:block;
      width: 60vw;
      padding: 1vw 3vw;
      margin-bottom: 3vw;
      border-radius: 1vw;
      background-color: lightblue;
      box-shadow: 0px 0px 5px grey;
    }

    .setting-title {
      font-weight: bold;
      margin: 1vw 0;
    }

    .setting-slider {
      width: 100%;
      height: 5vw;
    }

    .setting-desc {
      display:flex;
      justify-content: space-between;
    }
    
    #sep-setting {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .switch {
      position: relative;
      display: inline-block;
      width: 15vw;
      height: 8vw;
    }

    .switch input { 
      opacity: 0;
      width: 0;
      height: 0;
    }

    .switch-handle {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      border-radius: 8vw;
      background-color: #ccc;
      -webkit-transition: .4s;
      transition: .4s;
    }

    .switch-handle:before {
      position: absolute;
      content: "";
      height: 6vw;
      width: 6vw;
      left: 1vw;
      bottom: 1vw;
      border-radius: 50%;
      background-color: white;
      -webkit-transition: .4s;
      transition: .4s;
    }

    input:checked + .switch-handle {
      background-color: #2196F3;
    }

    input:checked + .switch-handle:before {
      -webkit-transform: translateX(7vw);
      -ms-transform: translateX(7vw);
      transform: translateX(7vw);
    }

    /*********** Sentence Color **************/
    
    .sent[data-color] > span.subj{
      background-color: pink;
    }
    
    .sent[data-color] > span.verb{
      background-color: yellow;
    }

    .sent[data-color] > span.obj{
      background-color: lightgreen;
    }

    /* .sent[data-color] > span.aux{
      background-color: lightgrey;
    } */

    
  </style>
  <script>
    // partFormats = {
    //   "subj":{
    //       "color":"Red",
    //       "border-color":"Pink"
    //   },
    //   "verb":{
    //       "color":"Yellow",
    //       "border-color":"LightYellow"
    //   },
    //   "obj":{
    //       "color":"Green",
    //       "border-color":"LightGreen"
    //   }
    // }
  </script>

</head>
<body>
  <header>
    <p id="title">The Recluse</p>
    <div id="instruct"><ol>
      <li>Tap a word for dictionary</li>
      <li>Double Tap for Sentence Structure Preview</li>
    </ol>
    </div>
    <div id="arrow"></div>
  </header>
  <div id="article-wrapper">
  <article class="color-reader">
    <p><span class="sent", data-dif = "1"><span class="aux">Twenty-five years later</span> <span class="subj">a ship</span> <span class="verb">appeared</span>, <span class="aux">on an afternoon in the planet's summer</span>.</span>
    </p>
    <p><span class="sent", data-dif = "3"><span class="subj">Arak Miller</span> <span class="verb">watched</span> <span class="obj">it</span> <span class="aux">from the mesa</span>.</span>
    </p>
    <p><span class="sent", data-dif = "3"><span class="aux">From Earth</span>, <span class="subj">he</span> <span class="verb">thought</span>.</span>
    <span class="sent", data-dif = "3">From Earth!</span>
    </p>
    <p><span class="sent", data-dif = "3">But <span class="subj">Arak Miller</span> <span class="verb">was</span> <span class="obj">an ordered man</span>.</span>
    <span class="sent", data-dif = "1"><span class="aux">Even now</span>,<span class="aux"> in the face of resurging visions of his wife</span>, <span class="aux">and his sons</span>, <span class="aux">and his work</span>, <span class="aux">and the mighty civilization from which he had been cut adrift</span>, <span class="subj">his thoughts</span> <span class="verb">were</span> <span class="obj">ordered</span>: <span class="aux">probably <span class="subj">the ship</span> <span class="verb">had arrived</span> <span class="obj">from Earth</span> <span class="aux">to resurvey one of the Class II uninhabitable planets of the Alpha Centaurus System</span></span>.</span>
    <span class="sent", data-dif = "2">Tomorrow <span class="subj">its scout ships</span> <span class="verb">would whip</span> <span class="aux">along the day sides</span> at <span class="aux">five thousand feet</span>.</span>
    <span class="sent", data-dif = "1">Tomorrow atop the mesa <span class="subj">he</span> <span class="verb">must light</span> <span class="obj">his pyres</span>, <span class="aux">some hundred-odd gigantic piles of pine trees and brush </span><span class="aux">that would burn with billowing smoke</span>.</span>
    <span class="sent", data-dif = "3"><span class="subj">He</span> <span class="verb">must signal</span> <span class="obj">the presence</span> <span class="aux">of a lone Earthman</span>.</span>
    </p>
    <p><span class="sent", data-dif = "1"><span class="aux">With a hypnotic intensity</span> <span class="subj">he</span> <span class="verb">stood</span> <span class="aux">watching the ship</span> until, toward evening, <span class="subj">it</span> <span class="verb">merged</span> <span class="aux">into the gray sky over the horizon</span>.</span>
    <span class="sent", data-dif = "2">Then<span class="subj"> he</span> <span class="verb">ran</span> <span class="aux">across the clearing</span> and <span class="aux">down to his house by the river that wound through the valley a thousand feet below</span>.</span>
    <span class="sent", data-dif = "3">"Come on, you fool!"</span>
    <span class="sent", data-dif = "2"><span class="subj">he</span> <span class="verb">shouted</span> to Marbach, sitting beneath a tree.</span>
    <span class="sent", data-dif = "2"><span class="subj">Arak Miller</span> <span class="verb">threw</span> <span class="obj">the figure </span>over his shoulder and <span class="verb">carried</span> <span class="obj">him</span> to the house.</span>
    <span class="sent", data-dif = "3"><span class="subj">He</span> <span class="verb">sat</span> <span class="obj">Marbach</span> <span class="aux">on a chair</span> and <span class="verb">went into</span> <span class="obj">the kitchen</span> <span class="aux">to eat</span>.</span>
    </p>
    <p><span class="sent", data-dif = "1"><span class="subj">Arak Miller</span> <span class="verb">had been</span> <span class="obj">nomadic</span> <span class="aux">the first few years after he crashed and had been abandoned for dead</span>, until <span class="subj">he</span> <span class="verb">found</span> <span class="aux">in the planet's narrow temperate zone</span> <span class="obj">one of the few arable regions capable of sustaining him</span>.</span>
    <span class="sent", data-dif = "1"><span class="subj">There</span> <span class="verb">was</span> <span class="obj">sufficient small game</span>, <span class="aux">the river was cool</span>, <span class="aux">and because the rain fell mainly in the valley</span>, <span class="aux">his pyres were safe</span>.</span>
    </p>
    <p><span class="sent", data-dif = "3"><span class="aux">In recent years</span> <span class="subj">he</span> <span class="verb">was</span> <span class="obj">always building</span>.</span>
    <span class="sent", data-dif = "1"><span class="subj">He</span> <span class="verb">had added</span> <span class="obj">a front porch</span> <span class="aux">to the cabin he had started with</span>, then <span class="obj">more rooms</span> <span class="aux">which he had never used</span>, then an <span class="obj">attic</span> <span class="aux">into which he never went</span>.</span>
    <span class="sent", data-dif = "3">Now <span class="subj">it</span> <span class="verb">was</span> <span class="obj">a house</span>.</span>
    <span class="sent", data-dif = "1"><span class="subj">It</span> <span class="verb">had</span> <span class="obj">chairs and tables</span>, <span class="obj">a bed</span>, <span class="obj">a rug of vines</span>, <span class="obj">a garden for vegetables and tobacco</span>, <span class="obj">and a garden for flowers</span>.</span>
    </p>
    <p><span class="sent", data-dif = "2"><span class="subj">He</span> <span class="verb">ate</span> <span class="obj">a leisurely meal of potatoes and corn and meat of the rabbit-like creatures which he trapped</span>.</span>
    <span class="sent", data-dif = "3"><span class="subj">Miss Gormeley</span> <span class="verb">was sitting</span> <span class="obj">on the porch</span> <span class="aux">as he went out</span>.</span>
    <span class="sent", data-dif = "3"><span class="obj">"A ship's come,"</span> <span class="subj">he</span> <span class="verb">shouted</span>.</span>
    <span class="sent", data-dif = "3">"I may be saved, you understand?"</span>
    </p>
    <p><span class="sent", data-dif = "2"><span class="subj">He</span> <span class="verb">recalled</span> <span class="obj">he had intended to do something about Miss Gormeley's nostril</span>.</span>
    <span class="sent", data-dif = "3"><span class="aux">With one of his knives</span> <span class="subj">he</span> <span class="verb">scraped</span> <span class="aux">a little against the wall of her left nostril</span>.</span>
    <span class="sent", data-dif = "3">Then <span class="subj">he</span> <span class="verb">stood back</span>, satisfied.</span>
    <span class="sent", data-dif = "3"><span class="obj">"Now you look better,"</span> <span class="subj">he</span> <span class="verb">said</span>.</span>
    <span class="sent", data-dif = "3"><span class="aux">With a wry grin</span> <span class="subj">he</span> <span class="verb">added</span>, <span class="obj">"You can smell better, too."</span></span> 
    </p>
    <p><span class="sent", data-dif = "2"><span class="aux">For a long time</span> <span class="subj">he</span> <span class="verb">could not sleep</span>, <span class="aux">remembering that he had been cut off in the prime of his life</span>.</span>
    <span class="sent", data-dif = "1"><span class="subj">He</span> <span class="verb">had been</span> <span class="obj">the Senior Astrophysicist</span> <span class="aux">in the Systems War Office on Earth</span>, <span class="aux"><span class="verb">working on</span> <span class="obj">the Second Einstein Modifications</span> <span class="aux">that promised travel to the more distant galactic Systems</span></span>.</span>
    <span class="sent", data-dif = "1"><span class="subj">He</span> <span class="verb">had completed</span> <span class="obj">six months of comparison spectography</span> <span class="aux">in the barren Centaurus System and</span> <span class="verb">had been about to take</span> <span class="obj">the year's return journey to Earth</span>, <span class="aux">looking forward to a vacation trip with his family to Venus City</span>.</span>
    <span class="sent", data-dif = "2"><span class="subj">He</span> <span class="verb">had been in</span> <span class="obj">the forefront of the free world's pushing back of the last frontiers of man</span>.</span>
    </p>
    <p><span class="sent", data-dif = "3"><span class="subj">He</span> <span class="verb">twisted</span> <span class="aux">on his bed</span> <span class="aux">in a wild agony of hope and yearning</span>.</span>
    <span class="sent", data-dif = "2"><span class="obj">"Someday soon,"</span> <span class="subj">he</span> <span class="verb">shouted</span><span class="aux"> to the walls</span>, "<span class="subj">I'll</span> <span class="verb">ride</span> <span class="obj">the monorail across the Western plains</span>."</span>
    <span class="sent", data-dif = "1"><span class="subj">He</span> <span class="verb">had discovered</span><span class="obj"> that it helped, to talk aloud,</span> <span class="aux">though none of his devices could make him forget he was a prisoner</span>.</span>
    <span class="sent", data-dif = "1"><span class="subj">To feel the Centaurus skies closing down on him and the alien mountains crushing him, so far from his work and those he loved,</span> <span class="verb">was</span> <span class="obj">to feel a terrible suffocation from which there was no release</span>.</span>
    </p>
    <p><span class="sent", data-dif = "1">But then <span class="subj">he</span> <span class="verb">would go doggedly</span> <span class="obj">to work</span>, or else <span class="verb">carve</span> <span class="obj">the life-size figures</span> <span class="aux">to keep him silent company</span>, <span class="aux">and try to forget</span>.</span>
    </p>
    <p><span class="sent", data-dif = "3"><span class="subj">He</span> <span class="verb">talked on and on</span>, and finally <span class="subj">he</span> <span class="verb">could talk no more</span>.</span>
    <span class="sent", data-dif = "3"><span class="subj">He</span> <span class="verb">slept</span>.</span>
    </p>
    <p><span class="sent", data-dif = "3"><span class="subj">He</span> <span class="verb">was awakened</span> by <span class="aux">a pattering on the roof</span>.</span>
    </p>
    <p><span class="sent", data-dif = "3">"Rain!"</span>
    <span class="sent", data-dif = "3"><span class="subj">he</span> <span class="verb">shouted</span>.</span>
    <span class="sent", data-dif = "3"><span class="subj">He</span> <span class="verb">jumped up</span> and <span class="verb">ran to the window socket</span>.</span>
    <span class="sent", data-dif = "3"><span class="subj">The rain clouds</span> <span class="verb">were</span> <span class="obj">high</span>, and <span class="obj">heavy with storm</span>.</span>
    </p>
    <p><span class="sent", data-dif = "3"><span class="subj">It</span> <span class="verb">struck</span> <span class="obj">him</span> <span class="aux">like a blow</span>: <span class="subj">they</span> <span class="verb">hung</span> <span class="aux">above the mesa</span>.</span>
    </p>
    <p><span class="sent", data-dif = "3">Above his pyres.</span>
    </p>
    <p><span class="sent", data-dif = "1"><span class="aux">In a panic</span> <span class="subj">he</span> <span class="verb">clambered up</span> <span class="obj">to the mesa</span>, <span class="aux">forgetting his breakfast</span>, <span class="aux">forgetting his outer clothing</span>, his mind in disorder.</span>
    </p>
    <p><span class="sent", data-dif = "3"><span class="subj">The shock wave</span> <span class="verb">pounded</span> <span class="obj">his eardrums</span>.</span>
    </p>
    <p><span class="sent", data-dif = "3"><span class="subj">He </span><span class="verb">was too startled</span> <span class="aux">to make words</span>.</span>
    <span class="sent", data-dif = "1"><span class="aux">With unbelieving eyes</span> <span class="subj">he</span> <span class="verb">saw</span>, <span class="aux">about five miles away where the river emptied into the sea</span>, <span class="obj">the black cloud of an atomic explosion rise into the sky to spread out under the rain</span>.</span>
    </p>
    <p><span class="sent", data-dif = "2"><span class="aux">Then suddenly</span> <span class="subj">he</span> <span class="verb">was running blindly</span> <span class="aux">through the rain</span>.</span>
    <span class="sent", data-dif = "3"><span class="subj">The scout</span> <span class="verb">must have come down</span>.</span>
    <span class="sent", data-dif = "3"><span class="subj">They</span> <span class="verb">must be testing</span>.</span>
    <span class="sent", data-dif = "2"><span class="subj">The area</span> <span class="verb">was ideal for</span> <span class="obj">testing atomic weapons</span>.</span>
    <span class="sent", data-dif = "3"><span class="subj">I</span> <span class="verb">must reach</span> <span class="obj">them</span> <span class="aux">before they leave</span>.</span>
    </p>
    <p><span class="sent", data-dif = "3"><span class="aux">Through heavy undergrowth</span> <span class="subj">he</span> <span class="verb">pushed his way</span> <span class="aux">down the slope to the valley</span>.</span>
    <span class="sent", data-dif = "3"><span class="subj">His foot</span> <span class="verb">slipped</span> <span class="obj">on an exposed root</span>.</span>
    <span class="sent", data-dif = "3"><span class="aux">With a sharp crack of bone</span>, <span class="subj">he</span> <span class="verb">fell</span>.</span>
    </p>
    <p><span class="sent", data-dif = "3"><span class="obj">"My ankle!</span>"</span>
    <span class="sent", data-dif = "3"><span class="subj">he</span> <span class="verb">screamed</span>, <span class="aux">with terror smashing at his mind</span>.</span>
    <span class="sent", data-dif = "3"><span class="subj">He</span> <span class="verb">managed to find</span> <span class="obj">two thick lengths of branch</span> <span class="aux">that would serve as crutches</span>.</span>
    <span class="sent", data-dif = "1">Then <span class="subj">he</span> <span class="verb">started hobbling</span> <span class="aux">awkwardly</span> <span class="aux">toward the river</span>.</span>
    </p>
    <p><span class="sent", data-dif = "2"><span class="aux">For an hour</span> <span class="subj">he</span> <span class="verb">forced himself on</span> <span class="aux">urgently along the river bank</span>, <span class="verb">now feeling</span> <span class="obj">knife-like pains</span> <span class="aux">slicing up through his body</span>.</span>
    <span class="sent", data-dif = "2"><span class="subj">The effort of moving</span><span class="verb"> was beginning</span> <span class="obj">to exhaust him</span>.</span>
    </p>
    <p><span class="sent", data-dif = "3"><span class="subj">He</span> <span class="verb">fell down</span>, <span class="verb">and rested a moment</span>.</span>
    <span class="sent", data-dif = "3"><span class="subj">He</span> <span class="verb">heard</span> <span class="obj">a tree crash in the forest ahead</span>.</span>
    <span class="sent", data-dif = "3"><span class="subj">He</span> <span class="verb">heard</span> <span class="obj">someone shout</span>.</span>
    </p>
    <p><span class="sent", data-dif = "3">A human voice!</span>
    </p>
    <p><span class="sent", data-dif = "2"><span class="subj">He</span> <span class="verb">began to sob</span>, <span class="aux">softly at first, then uncontrollably</span>.</span>
    <span class="sent", data-dif = "3">A human voice!</span>
    <span class="sent", data-dif = "3"><span class="subj">It</span> <span class="verb">had never been</span> <span class="obj">so sweet a sound</span>.</span>
    </p>
    <p><span class="sent", data-dif = "2"><span class="subj">He</span> <span class="verb">climbed painfully</span> <span class="obj">to his feet</span>, <span class="aux">crashed on through the undergrowth</span>.</span>
    <span class="sent", data-dif = "2"><span class="subj">The density of trees</span> <span class="verb">ended abruptly</span> and <span class="subj">he</span> <span class="verb">stopped</span>.</span>
    <span class="sent", data-dif = "2"><span class="aux">Around the scout ship in the clearing beyond</span>, <span class="subj">robot dredges</span> <span class="verb">were digging</span> <span class="obj">the foundations for buildings</span>.</span>
    <span class="sent", data-dif = "2"><span class="subj">Gray-uniformed men</span> <span class="verb">were setting up</span> <span class="obj">new-type atomic artillery at the perimeters</span>.</span>
    </p>
    <p><span class="sent", data-dif = "3"><span class="subj">Arak Miller</span> <span class="verb">drew</span> <span class="obj">a deep breath</span>.</span>
    <span class="sent", data-dif = "3"><span class="obj">"I'm saved,"</span> <span class="subj">he</span> <span class="verb">said</span>, <span class="subj">his voice</span> <span class="verb">breaking</span>.</span>
    <span class="sent", data-dif = "3">"<span class="verb">I'm </span><span class="verb">going to be</span> <span class="obj">a free man</span>!"</span>
    <span class="sent", data-dif = "2"><span class="subj">He</span> <span class="verb">tottered on the edge of hysteria</span>, but <span class="verb">controlled himself with a mighty effort of will</span>.</span>
    </p>
    <p><span class="sent", data-dif = "3"><span class="subj">He</span> <span class="verb">took a step forward</span><span class="aux"> to reach the clearing</span>.</span>
    <span class="sent", data-dif = "3">Then <span class="subj">he</span> <span class="verb">stopped</span>.</span>
    </p>
    <p><span class="sent", data-dif = "3"><span class="subj">Something</span> <span class="verb">was</span> <span class="obj">wrong</span>.</span>
    </p>
    <p><span class="sent", data-dif = "3"><span class="subj">He</span> <span class="verb">tried to put together</span> <span class="obj">the pieces of his mind</span>.</span>
    <span class="sent", data-dif = "1"><span class="subj">Everything</span> <span class="verb">looked</span> <span class="obj">normal</span>.</span>
    <span class="sent", data-dif = "1"><span class="aux">Construction going on</span>, <span class="aux">stores being transferred to temporary warehouses</span>, <span class="aux">all the usual activities of a scout party on an atomic testing mission</span>.</span>
    <span class="sent", data-dif = "3"><span class="subj">The artillery</span> <span class="verb">was</span> <span class="obj">pointing</span>—</span>
    </p>
    <p><span class="sent", data-dif = "3"><span class="subj">That</span> <span class="verb">was</span><span class="obj"> the flaw</span>.</span>
    </p>
    <p><span class="sent", data-dif = "3"><span class="subj">The artillery</span> <span class="verb">faced</span> <span class="obj">inward</span>.</span>
    </p>
    <p><span class="sent", data-dif = "3"><span class="subj">He</span> <span class="verb">looked back at</span> <span class="obj">the construction work</span>.</span>
    <span class="sent", data-dif = "2"><span class="obj">"Not foundations for buildings,"</span> <span class="subj">he</span> <span class="verb">said dully</span>.</span>
    <span class="sent", data-dif = "1">"Ditches."</span>
    </p>
    <p><span class="sent", data-dif = "3">As he watched, <span class="subj">a flag</span> <span class="verb">was run up on a pole</span>.</span>
    <span class="sent", data-dif = "3"><span class="subj">The dreams of Arak Miller</span> <span class="verb">crashed</span> <span class="obj">in his mind</span>.</span>
    </p>
    <p><span class="sent", data-dif = "2"><span class="subj">It</span> <span class="verb">was</span> <span class="obj">the flag of the slave world</span>, <span class="aux">super-imposed upon the symbol of the Systems</span>.</span>
    <span class="sent", data-dif = "1"><span class="aux">The world controlled by the dictators</span>, <span class="subj">which</span> <span class="aux">for centuries</span> <span class="verb">had existed</span> <span class="aux">alongside the free world in a perpetual cold war</span>.</span>
    <span class="sent", data-dif = "1"><span class="aux">During some stage of Arak Miller's long imprisonment</span>, <span class="aux">from Venus to Centaurus</span> <span class="subj">the dictators</span> <span class="verb">had taken over</span>.</span>
    </p>
    <p><span class="sent", data-dif = "3"><span class="aux">Hidden from guards</span>, <span class="subj">he</span> <span class="verb">lay on the ground</span> and<span class="verb"> watched for a long time</span>.</span>
    <span class="sent", data-dif = "1"><span class="aux">Only when the next batch of captives was taken out of the scout ship and lined up in front of the ditch</span>, did <span class="subj">he</span> <span class="verb">turn</span> <span class="obj">his gaze away</span>.</span>
    </p>
    <p><span class="sent", data-dif = "2"><span class="subj">He</span> <span class="verb">waited</span> <span class="aux">till the next shock wave had passed</span>, <span class="aux">then with tears streaming down his face</span>, <span class="verb">hobbled back in the rain</span> <span class="aux">toward the river</span>.</span>
    <span class="sent", data-dif = "3"><span class="subj">He</span> <span class="verb">crawled</span> <span class="aux">the last two miles</span> <span class="aux">to his house</span>.</span>
    <span class="sent", data-dif = "3"><span class="subj">Miss Gormeley</span> <span class="verb">was sitting</span> <span class="aux">where he had left her</span>.</span>
    <span class="sent", data-dif = "3"><span class="obj">"I am sorry,"</span> <span class="subj">he</span> <span class="verb">said painfully</span>.</span>
    <span class="sent", data-dif = "3">"<span class="subj">I</span> <span class="verb">will have to destroy</span> <span class="obj">you</span>.</span>
    <span class="sent", data-dif = "3"><span class="obj">And Marbach</span>.</span>
    <span class="sent", data-dif = "3"><span class="obj">And our house</span>, <span class="obj">and the pyres</span>.</span>
    <span class="sent", data-dif = "3"><span class="aux">And when all that is done</span>, <span class="subj">I</span> <span class="verb">will have to leave</span> <span class="obj">this area</span>.</span>
    <span class="sent", data-dif = "3"><span class="aux">Otherwise</span> <span class="subj">they</span> <span class="verb">might find me</span>."</span>
    </p>
    <p><span class="sent", data-dif = "2"><span class="subj">Miss Gormeley</span> <span class="verb">stared blindly</span> <span class="aux">out at the river</span>.</span>
    </p>
    <p><span class="sent", data-dif = "3"><span class="subj">He</span> <span class="verb">lay still</span> <span class="aux">on the floor</span>, <span class="verb">gasping for breath</span>.</span>
    <span class="sent", data-dif = "3"><span class="obj">"You see," </span><span class="subj">he</span> <span class="verb">explained</span>, "<span class="subj">I</span> <span class="verb">am not</span> <span class="obj">a prisoner</span>.</span>
    <span class="sent", data-dif = "3"><span class="subj">They</span> <span class="verb">are</span> <span class="obj">the prisoners</span>.</span>
    <span class="sent", data-dif = "3">All of them.</span>
    <span class="sent", data-dif = "3">All the world—but me."</span>
    </p>
    <p><span class="sent", data-dif = "3"><span class="subj">His eyes</span> <span class="verb">closed</span> <span class="aux">in exhaustion</span>.</span>
    <span class="sent", data-dif = "3"><span class="obj">"I like it here now,"</span> <span class="subj">he</span> <span class="verb">said</span>, <span class="aux">almost in a whisper</span>.</span>
    <span class="sent", data-dif = "3">"<span class="subj">I</span> <span class="verb">intend</span> <span class="obj">to stay</span>.</span>
    <span class="sent", data-dif = "2"><span class="aux">There must be some place here where</span> <span class="subj">they</span> <span class="verb">can never find me</span>, <span class="aux">you understand</span>?"</span>
    </p>
    
  </article>
 <div id="dict-modal" class="modal">
    <!-- Modal content -->
    <div class="modal-content">
      <div class="dict-word">word</div>
      <div class="dict-meaning">meaning</div>
    </div>
  </div>
  <div id="setting-wrapper">
    <div id="menu-btn"><div></div> <div></div> <div></div></div>
    <div id="setting-elems">
      <div id="sent-setting" class="setting-elem">
        <div class="setting-title">Sentence Structure Preview</div>
        <input id="sent-slider" class="setting-slider" type="range" min="0", max="3" step="1" value="0">
        <div class="setting-desc"><div>No</div><div>1</div><div>2</div><div>All</div></div>
      </div>
      <div id="sep-setting" class="setting-elem">
        <span class="setting-title">Sentence Seperator</span>
        <label class="switch">
          <input id="sep-btn" type="checkbox">
          <span class="switch-handle"></span>
        </label>      
      </div>
    </div>    
  </div>
  <div id="words-container">
    <div class="word-unit" id="word-templete">
      <div class="word-wrapper">
        <div class="word">example</div><div class="meaning">예시</div>
      </div>
      <div class="sents-container">
        <div class="sent-unit"><p class="sent">This is a example string.</p>[offset]<span class="offset">100</span></div> 
      </div>
    </div>
  </div>

  <script src="./lib/doubleTap.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.0.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.0.0/firebase-analytics.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.0.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.0.0/firebase-database.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.0.0/firebase-firestore.js"></script>
  <script>
  // Your web app's Firebase configuration
  // For Firebase JS SDK v7.20.0 and later, measurementId is optional
  var firebaseConfig = {
    apiKey: "AIzaSyDd_mFhjZOXCRmv09ru8jB97Nk7EwEzk6A",
    authDomain: "engbook-96968.firebaseapp.com",
    databaseURL: "https://engbook-96968.firebaseio.com",
    projectId: "engbook-96968",
    storageBucket: "engbook-96968.appspot.com",
    messagingSenderId: "238613987334",
    appId: "1:238613987334:web:818432d0e89df2d65cc387",
    measurementId: "G-GQ1RSREC30"
  };
  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  firebase.analytics();

  // Auth
  var provider = new firebase.auth.GoogleAuthProvider();
  var userId ="", displayName = "";
  var ref_words;

  function initUserDataOnAuth(user){
    userId = user.uid;
    displayName = user.displayName;
    ref_words = database.ref('users/'+userId+'/words/');
    readUserData();
  }
  
  //=================================================================

  var database = firebase.database();
  // No Login
  userId = "jaehyeon";
  displayName = "Jaehyeon Park";

  userId="";
  while(userId==""){
    userId = prompt("ID를 입력해주세요", "");
  }
  userId+="-RC";

  ref_words = database.ref('users/'+userId+'/words/');
  readUserData();

  // Write to Firebase
  function writeUserData(userId, word, meaning, sent, offset) {
    if(userId.length == 0){
      return; 
    }

    ref_words.child(word).set({
      word: word,
      meaning: meaning,
      sents: [{sent:sent, offset:offset}],
      time: firebase.firestore.Timestamp.now().seconds
    });
    console.log(word);
  }

  // Read From Firebase
  function readUserData(){
    ref_words.orderByChild('time').on('child_added', function(snapshot){
      var child_val = snapshot.val();
      with(child_val){
        appendWord(word, meaning, sents);
      }
      console.log(child_val);
    });
  }

  function appendWord(word, meaning, sents){
    function appendSent(sent, offset, container){
      newSent = container.firstElementChild.cloneNode(true);
      // var re = new RegExp(word, "gi");
      // sent.replace(re, "<s></s>");
      newSent.querySelector(".sent").innerText = sent;
      newSent.querySelector(".offset").innerText = offset;
      container.appendChild(newSent);
    }
    
    words_container = document.querySelector("#words-container");
    temp = words_container.querySelector("#word-templete").cloneNode(true);
    temp.style.display = "static";
    temp.id = "";
    with(temp){
      querySelector(".word").innerText = word;
      querySelector(".meaning").innerText = meaning;
      sents_container = querySelector(".sents-container");
      for(_sent of sents){
        appendSent(_sent.sent, _sent.offset, sents_container);
      }
      sents_container.removeChild(sents_container.firstElementChild)
    }
    words_container.prepend(temp);
  }

  //=================================================================
  var sents = document.querySelectorAll("p > span.sent");

  for(sent of sents){
    splitElem2Words(sent);
  }

  console.log("....word tokenize end.......")

  function splitElem2Words(elem){
    var childs = elem.childNodes;
    var newElem = elem.cloneNode(false);
    var len = childs.length;
    for(var i=0; i<len; i++){
      var c = childs[i].cloneNode(true);
      newElem.appendChild(c);
      switch(c.nodeType){
        case 3: // Bound Case : textNode(3)
          splitTextNode2Words(c);
          break;
        case 1: // Recursive : Element
          splitElem2Words(c);
          break;
        default:
          console.log(c);
          break;
      }
    }
    
    elem.replaceWith(newElem);
  }

  function splitTextNode2Words(textNode){
    const re = /\w*/g
    
    console.log(textNode.wholeText);
    while(textNode != undefined && textNode.wholeText.length > 0){
      var matchs = textNode.wholeText.match(re);
      var start_offset = 0;
      var word_length = 0;

      for(m of matchs){
        if(m.length == 0){ start_offset++; continue;}

        word_length = m.length;
        break;
      }
      
      if(start_offset > 0){
        // Last non-word
        if(start_offset >= textNode.length){break;}
        textNode = textNode.splitText(start_offset);
      }

      // Not Last Word
      if(word_length < textNode.wholeText.length){
        var nextNode = textNode.splitText(word_length);
      }
      var wordNode = document.createElement("span");
      wordNode.classList.add("word");
      wordNode.appendChild(textNode.cloneNode());
      textNode.replaceWith(wordNode);

      textNode = nextNode;
    }
  }

  sents = document.querySelectorAll("article > p > span.sent");
  for(let sent of sents){
    sent.addEventListener("touchstart", onTouchStart);
    sent.addEventListener("touchend", onTouchEnd);
    sent.addEventListener("touchmove", onTouchMove);
  }

  var touch_timeout;
  var isFirstTap = true;
  var isMoved = false;
  function onTouchStart(evt){
    window.clearTimeout(touch_timeout);
    console.log("onTouchStart");
  }

  function onTouchMove(evt){
    window.clearTimeout(touch_timeout);
    isMoved = true;
    console.log("onTouchMove");
  }

  function onTouchEnd(evt){
    if(isMoved){isMoved=false; isFirstTap=true; return;}

    if(isFirstTap){
      touch_timeout = window.setTimeout(function(){
        onClick(evt);
        isFirstTap = true;
      }, 250);
      isFirstTap = false;
    }else{
      onDblClick(evt);
      isFirstTap = true;
    }
    console.log("onTouchEnd");
  }

  function changeSpanColor(target){
    if(!target.dataset.color){
      target.dataset.color=1;
    }else{
      delete target.dataset.color;
    }
  }
    
  function onDblClick(evt){
    if(evt.currentTarget.className != "sent"){
        evt.currentTarget.style.backgroundColor="white";
    }
    
    changeSpanColor(evt.currentTarget);

    evt.stopPropagation();
  }

  var httpRequest;
  function onClick(evt){
    // word event delegation
    if(evt.target.className == "word"){
      // var sent = evt.currentTarget.innerText;
      var sent = evt.target.closest(".sent").innerText;
      var word = evt.target.innerText;
      
      // send dictionary request
      httpRequest = new XMLHttpRequest();
      httpRequest.onreadystatechange = function(){
        if (httpRequest.readyState === XMLHttpRequest.DONE){
          if (httpRequest.status == 200){
            // alert(httpRequest.responseText);
            const json = JSON.parse(httpRequest.responseText);
            var orign_word = "";
            var meaning = "";

            // word not found
            if (json.title != undefined){ showDictModal(null, "...no meaning");return; }

            // https://api.dictionaryapi.dev/api/v2/entries/en/bear
            // homophone: 0:doing 1:Animal // meanings : 0:Noun  1:Verb // defintions: 0:carry weight 1:endure
            for( hmp of json ) { 
              orign_word = hmp.word;
              meaning += hmp.meanings[0].definitions[0].definition + "\n";
              break;
            }
            meaning = meaning.trim();
            
            showDictModal(orign_word, meaning);
            writeUserData(userId, orign_word, meaning, sent, 100);
          }else{
            showDictModal(null,"dictionary request failed..." );
            // alert("dictionary request failed...");
          }
        }
      }
      httpRequest.open('GET', 'https://api.dictionaryapi.dev/api/v2/entries/en/'+word, true)
      httpRequest.send(null);
      with(evt.target.getClientRects()[0]){
      showDictModal(word, "...searching",left, top);
      }
    }
  }

  // Get the modal
  var modal = document.querySelector("#dict-modal");

  // When the user clicks anywhere outside of the modal, close it
  window.onclick = function(event) {
      alert("click!");
      if (event.target == modal) {
          closeModal();
      }
  }

  function showDictModal(word, meaning, left, bottom){
      modal.style.display = "block";
      if(word != null){ modal.querySelector(".dict-word").innerText = word; }
      if(meaning != null) { modal.querySelector(".dict-meaning").innerText = meaning; }
      if(left != undefined){
        var mc = modal.querySelector(".modal-content");
        var modal_rect = modal.getBoundingClientRect();
        var mc_rect = mc.getBoundingClientRect();
        mc.style.left= ((left + mc_rect.width > modal_rect.width)?modal_rect.width-mc_rect.width:left) +"px";
        // if(left + mc_rect.width > modal_rect.width){
        //   mc.style.left = modal_rect.width-mc_rect.width +"px"; 
        // }
        // else{ 
        //   mc.style.left= left +"px"; 
        // }
      }
      if(bottom != undefined){
        // CAUTION: bottom=0 means bottom of screen
        const marginBottom = 1 * (document.documentElement.clientWidth / 100); // vw2px
        var mc = modal.querySelector(".modal-content");
        // word-top 2 bottom
        var modal_rect = modal.getBoundingClientRect();
        bottom = modal_rect.height - bottom;
        var mc_rect = mc.getBoundingClientRect();
        if(bottom + mc_rect.height + marginBottom > modal_rect.height){
          mc.style.bottom="";
          mc.style.top= 0+"px";
        } else{
          mc.style.top="";
          mc.style.bottom= (bottom + marginBottom) +"px";
        }
      }
  }

  function closeModal(){
      modal.style.display = "none";
  }

  document.querySelector("#sep-btn").addEventListener('change', function(evt){
    var sents = document.querySelectorAll("span.sent");
    if(evt.target.checked){
      for(sent of sents){ sent.dataset.slash = 1; }
    }else{
      for(sent of sents){ delete sent.dataset.slash;}
    }
  });

  document.querySelector("#sent-slider").addEventListener('change', function(evt){
    var value = parseInt(evt.target.value);
    var sents = document.querySelectorAll("span.sent");
    switch(value){
      case 0:
        for(sent of sents){delete sent.dataset.color;}
        break;
      case 1:
      case 2:
        for(sent of sents){
          if(sent.dataset.dif <= value){
            sent.dataset.color = 1;
          }else{
            delete sent.dataset.color;
          }
        }
        break;
      default:
        for(sent of sents){sent.dataset.color=1;}
        break;
    }
  });

  document.querySelector("#menu-btn").addEventListener('click', function(evt){
    if(evt.currentTarget.dataset.on){delete evt.currentTarget.dataset.on;}
    else{evt.currentTarget.dataset.on=1;}
    evt.stopPropagation();
  })






  </script>
</body>
</html>